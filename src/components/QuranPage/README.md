# مكونات عرض صفحات القرآن المحسنة

## نظرة عامة

تم تطوير وتحسين نظام عرض صفحات القرآن الكريم ليوفر تجربة متكاملة تشمل:

- عرض صفحات SVG من الخادم الخارجي
- تظليل الآيات أثناء التشغيل الصوتي
- تكامل مع مشغل الصوت
- نافذة التفسير التفاعلية
- استخدام البيانات المحلية

## المكونات الرئيسية

### 1. SVGPageViewer.jsx

**الوظائف:**
- عرض صفحات القرآن بصيغة SVG
- تظليل الآيات بناءً على التوقيتات الصوتية
- دعم التكبير والتصغير
- إمكانية النقر على الآيات لعرض التفسير

**الخصائص:**
```jsx
<SVGPageViewer
  pageNumber={1}              // رقم الصفحة
  currentAyah={ayahData}      // بيانات الآية الحالية
  ayahTimings={timings}       // توقيتات الآيات
  zoomLevel={1.2}            // مستوى التكبير
  onAyahClick={handleClick}   // معالج النقر على الآية
  onTouchStart={handleTouch}  // معالج اللمس
  onTouchMove={handleMove}    // معالج حركة اللمس
  onTouchEnd={handleEnd}      // معالج انتهاء اللمس
  className="custom-class"    // فئة CSS مخصصة
/>
```

### 2. صفحة [page].jsx المحسنة

**الميزات الجديدة:**
- تكامل كامل مع SVGPageViewer
- مشغل صوت متقدم مع تظليل الآيات
- نافذة تفسير تفاعلية
- استخدام البيانات المحلية من `public/json`
- تصميم متجاوب مع Material-UI

**البيانات المستخدمة:**
- `public/json/metadata.json` - معلومات السور
- `public/json/surah/surah_X.json` - بيانات السور
- `public/json/audio/audio_surah_X.json` - ملفات الصوت
- API خارجي للتوقيتات والصور

## نظام pageMapping

### الغرض
ربط صفحات المصحف بالسور والآيات الموجودة فيها.

### الوظائف المتاحة:

```javascript
import { getPageInfo, getMainSurahForPage, findPageForAyah } from '../../utils/pageMapping';

// الحصول على معلومات الصفحة
const pageInfo = await getPageInfo(1);

// الحصول على السورة الرئيسية في الصفحة
const mainSurah = getMainSurahForPage(1);

// البحث عن الصفحة التي تحتوي على آية معينة
const pageNumber = findPageForAyah(2, 255); // آية الكرسي
```

## التكامل مع مشغل الصوت

### الميزات:
- تشغيل صوت السورة مع تظليل الآيات
- دعم متعدد القراء
- توقيتات دقيقة للآيات
- تحكم كامل في التشغيل

### الاستخدام:
```jsx
<QuranAudioPlayer
  surahNumber={1}
  reciterId={5}
  onCurrentAyahChange={setCurrentAyah}
  onAyahTimingsChange={setAyahTimings}
  showAyahHighlight={true}
/>
```

## نافذة التفسير

### الميزات:
- عرض تفسير من مصادر متعددة
- تفسير الجلالين، ابن كثير، السعدي
- إمكانية المشاركة والحفظ
- تصميم متجاوب

### الاستخدام:
```jsx
<TafseerPopup
  open={tafseerOpen}
  onClose={() => setTafseerOpen(false)}
  surahNumber={2}
  ayahNumber={255}
  ayahText="الله لا إله إلا هو..."
  surahName="البقرة"
/>
```

## مصادر البيانات

### البيانات المحلية:
- **metadata.json**: معلومات شاملة عن جميع السور
- **surah_X.json**: بيانات كاملة لكل سورة مع آياتها
- **verses/XXX_YYY.json**: ملف منفصل لكل آية
- **audio/audio_surah_X.json**: ملفات صوتية لكل سورة
- **quranMp3.json**: قائمة بجميع القراء

### APIs الخارجية:
- **mp3quran.net**: صور SVG للصفحات وتوقيتات القراءات
- **api.quran-tafseer.com**: تفسير الآيات

## التحسينات المطبقة

### 1. الأداء:
- تحميل تدريجي للبيانات
- تخزين مؤقت للصور والبيانات
- تحسين عرض SVG

### 2. تجربة المستخدم:
- تصميم متجاوب
- تحكم باللمس للأجهزة المحمولة
- تظليل تفاعلي للآيات
- تنقل سهل بين الصفحات

### 3. إمكانية الوصول:
- دعم لوحة المفاتيح
- تباين ألوان مناسب
- نصوص بديلة للصور
- تصميم صديق لقارئات الشاشة

## الاستخدام

### 1. التنقل للصفحة:
```
/quran-pages/1    // الصفحة الأولى (الفاتحة)
/quran-pages/255  // صفحة آية الكرسي
```

### 2. التحكم:
- **الأسهم**: التنقل بين الصفحات
- **F**: ملء الشاشة
- **+/-**: التكبير والتصغير
- **النقر على الآية**: عرض التفسير
- **أيقونة الصوت**: تشغيل/إيقاف الصوت

### 3. اللمس (الأجهزة المحمولة):
- **السحب يميناً/يساراً**: التنقل بين الصفحات
- **القرص**: التكبير والتصغير
- **النقر على الآية**: عرض التفسير

## المتطلبات

- React 18+
- Next.js 13+
- Material-UI 5+
- اتصال بالإنترنت لجلب صور SVG والتوقيتات

## الملاحظات

- البيانات المحلية محدثة ومطابقة للمصحف الشريف
- التوقيتات دقيقة ومتزامنة مع الصوت
- النظام قابل للتوسع لإضافة ميزات جديدة
- يدعم جميع المتصفحات الحديثة
