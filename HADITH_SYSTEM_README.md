# نظام إدارة الأحاديث المحلي

## نظرة عامة
تم تطوير نظام متكامل لإدارة والوصول إلى أحاديث صحيح البخاري ومسلم باستخدام الملفات المحلية بدلاً من الاعتماد على APIs خارجية.

## المكونات الرئيسية

### 1. وحدة قراءة البيانات (`hadithDataReader.js`)
- **المسار**: `src/utils/hadithDataReader.js`
- **الوظيفة**: قراءة وإدارة بيانات الأحاديث من الملفات المحلية
- **الميزات**:
  - تحميل 12,831 حديث من صحيح البخاري (7,224) ومسلم (5,607)
  - فلترة الأحاديث حسب المصدر
  - البحث في نصوص الأحاديث
  - الحصول على أحاديث عشوائية
  - إحصائيات شاملة للبيانات

### 2. APIs الجديدة

#### أ) `/api/hadith/random`
- **الغرض**: الحصول على حديث عشوائي
- **المعاملات**:
  - `source`: المصدر (البخاري/مسلم) - اختياري
  - `format`: تنسيق الاستجابة (simple/full)
- **مثال**: `GET /api/hadith/random?source=البخاري`

#### ب) `/api/hadith/search`
- **الغرض**: البحث في الأحاديث
- **المعاملات**:
  - `q` أو `query`: كلمة البحث (مطلوب)
  - `source`: المصدر - اختياري
  - `limit`: عدد النتائج (افتراضي: 50)
  - `format`: تنسيق الاستجابة
- **مثال**: `GET /api/hadith/search?q=الصلاة&source=البخاري`

#### ج) `/api/hadith/stats`
- **الغرض**: الحصول على إحصائيات قاعدة البيانات
- **مثال**: `GET /api/hadith/stats`

### 3. تحديث النظام اليومي (`daily-hadith.js`)
- تم تعديل النظام ليستخدم البيانات المحلية بدلاً من API خارجي
- يدعم الاختيار العشوائي بين البخاري ومسلم
- نظام احتياطي متقدم في حالة فشل قراءة البيانات

## البيانات المستخدمة

### مصدر البيانات
- **الملف**: `public/AlSahihehan/myData.json`
- **الحجم**: 15.5 MB
- **التنسيق**: JSON مع الحقول التالية:
  ```json
  {
    "id": "رقم فريد للحديث",
    "hadith": "نص الحديث مع التشكيل",
    "uhadith": "نص الحديث بدون تشكيل", 
    "source": "المصدر (صحيح البخاري/صحيح مسلم)"
  }
  ```

### الإحصائيات
- **إجمالي الأحاديث**: 12,831
- **صحيح البخاري**: 7,224 حديث (56.3%)
- **صحيح مسلم**: 5,607 حديث (43.7%)

## الميزات الجديدة

### 1. الأداء المحسن
- قراءة سريعة من الملفات المحلية
- عدم الاعتماد على اتصال الإنترنت
- تخزين مؤقت للبيانات في الذاكرة

### 2. البحث المتقدم
- البحث في نصوص الأحاديث
- فلترة حسب المصدر
- تمييز كلمات البحث في النتائج

### 3. إدارة الأخطاء
- نظام احتياطي متعدد المستويات
- رسائل خطأ واضحة
- تسجيل شامل للعمليات

## كيفية الاستخدام

### 1. في الكود
```javascript
import hadithReader from '../utils/hadithDataReader.js';

// حديث عشوائي
const hadith = await hadithReader.getRandomHadith();

// حديث من البخاري
const bukhariHadith = await hadithReader.getRandomHadith('البخاري');

// البحث
const results = await hadithReader.searchHadiths('الصلاة');

// الإحصائيات
const stats = await hadithReader.getDataStats();
```

### 2. عبر APIs
```bash
# حديث عشوائي
curl "http://localhost:3000/api/hadith/random"

# البحث
curl "http://localhost:3000/api/hadith/search?q=الزكاة"

# الإحصائيات
curl "http://localhost:3000/api/hadith/stats"
```

## الاختبار

### تشغيل الاختبارات
```bash
cd /path/to/quran_app
node src/utils/testHadithReader.js
```

### نتائج الاختبار الأخيرة
✅ جميع الاختبارات تمت بنجاح:
- تحميل البيانات: ✅
- الحديث العشوائي: ✅
- فلترة البخاري: ✅
- فلترة مسلم: ✅
- البحث: ✅ (687 نتيجة للبحث عن "الصلاة")
- الإحصائيات: ✅

## الملفات المُنشأة/المُعدلة

### ملفات جديدة:
1. `src/utils/hadithDataReader.js` - وحدة قراءة البيانات
2. `src/utils/testHadithReader.js` - ملف الاختبار
3. `src/pages/api/hadith/random.js` - API الحديث العشوائي
4. `src/pages/api/hadith/search.js` - API البحث
5. `src/pages/api/hadith/stats.js` - API الإحصائيات

### ملفات معدلة:
1. `src/pages/api/cron/daily-hadith.js` - تحديث لاستخدام البيانات المحلية

## المتطلبات
- Node.js
- ملف البيانات في `public/AlSahihehan/myData.json`
- وحدة fs (مدمجة في Node.js)

## المزايا الجديدة
1. **استقلالية كاملة**: لا يعتمد على APIs خارجية
2. **سرعة عالية**: قراءة مباشرة من الملفات المحلية
3. **موثوقية**: عدم تأثر بانقطاع الإنترنت
4. **مرونة**: إمكانية إضافة مصادر جديدة بسهولة
5. **شمولية**: يغطي جميع أحاديث الصحيحين

## الصيانة والتطوير المستقبلي
- إمكانية إضافة مصادر أخرى (سنن أبي داود، الترمذي، إلخ)
- تحسين خوارزمية البحث
- إضافة فهرسة للبحث السريع
- دعم البحث بالرقم أو الموضوع

---

**تاريخ الإنشاء**: 26 سبتمبر 2025  
**الإصدار**: 1.0.0  
**المطور**: نظام Cascade AI
